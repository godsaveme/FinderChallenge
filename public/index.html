<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Finder challenge</title>
    <meta charset="utf-8">
    <meta viewport="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Proxima+Nova" rel="stylesheet" type="text/css">
    <link href="/vendor/pure/pure-min.css" rel="stylesheet">
    <link href="/vendor/awesomplete/awesomplete.css" rel="stylesheet">
    <link href="/styles/index.css" rel="stylesheet">
    <script src="/scripts/global.js"></script>
    <script src="/scripts/search-form.js"></script>
    <script src="/scripts/app.js"></script>
  </head>
  <body>
    <div class="app pure-g">
      <header class="pure-u-1">
        <div class="pure-u-1-3">
          <h1 class="logo">Finder challenge!</h1>
        </div>
        <div class="pure-u-1-3">
          <div class="search-form">
            <form class="pure-form" id="searchForm" method="GET" onsubmit="return SearchForm(true)">
              <fieldset>
                <input type="text" id="inputSearch">
                <button class="pure-button pure-button-primary" type="submit">Buscar</button>
              </fieldset>
            </form>
          </div>
          <script>
            document.getElementById("searchForm").addEventListener("submit", function(event){
                event.preventDefault();
            });
            
            /**
             * flag: para validar si viene desde el onload o 
             * lanzado por el usuario
             */
            
            function SearchForm(flag){
            
                var search = location.hash.replace(/\/|#/gi,'');
                if(search.length > 0 && !flag){
                    document.getElementById("inputSearch").value = search;
                }
                var inputValue = document.getElementById("inputSearch").value;
                console.log(inputValue);
                location.hash = '/' + inputValue;
                console.log(location.hash);
                var tmp = dataRaw.data.filter(function(book){ 
                    //console.log(book.title);
                    return book.title.toUpperCase().includes(inputValue.toUpperCase());
                });
                console.log(tmp);
                CreateBooks(tmp);
            }
          </script>
        </div>
        <div class="pure-u-1-3"></div>
      </header>
      <aside class="filters pure-u-1-4"> 
        <h3>Búsquedas guardadas</h3>
        <h3>Categorías</h3>
        <h3>Idioma</h3>
        <h3>Publicación</h3>
        <h3>Presentación</h3>
      </aside>
      <content class="pure-u-3-4">
        <div id="booksContent">
          <div class="pure-g" id="booksRow"></div>
        </div>
        <script>
          loadJSON(JSON_FILE,function(response){
              RenderBooks(response);
          })
          
          var dataRaw;
          
          function RenderBooks(response){
              //_.each(response.data, function(books){
                  dataRaw = response;
                  CreateBooks(response.data);
                  console.log(response.data);
              //})
          }
          
          function CreateBooks(books){
              var booksRow = window.document.getElementById("booksRow");
              booksRow.innerHTML = '';
              for (var i = 0; i < books.length; i++) {
                  var book = new Book(books[i]);
                  booksRow.appendChild(book.createHtml());
              }
          }
          
          function Book(book){
              this.image = book.image;
              this.title = book.title;
              this.teaser = book.teaser;
              this.createHtml = function() {
                  var div = document.createElement("DIV");
                  div.className = "pure-u-1-3";
                  div.innerHTML = '<img src='+this.image+'>'  +
                                  '<h3>'+this.title+'</h3>'   +
                                  '<p>'+this.teaser+'</p>'    ;
                  return div;
              };
          }
        </script>
      </content>
      <footer class="pure-u-1"> </footer>
    </div>
    <script src="/vendor/underscore/underscore-min.js"></script>
    <script src="/vendor/awesomplete/awesomplete.min.js"></script>
  </body>
</html>